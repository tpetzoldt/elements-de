<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Thomas Petzoldt">
  <meta name="dcterms.date" content="2025-10-15">
  <title>Elemente der statistischen Datenanalyse und Statistik mit R – x4-Pipelines in R</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-cb13c09ad5a7270edb89df8c4c84031f.css">
  <link rel="stylesheet" href="../thpe.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

  <script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

  <script src="../site_libs/viz-1.8.2/viz.js"></script>

  <link href="../site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">

  <script src="../site_libs/grViz-binding-1.0.11/grViz.js"></script>

  <style>
  #title-slide 
    .title {color: #cef0ffff;}
    .subtitle {color: #ee7f00;}
    .quarto-title-author {color: #69af22;}
    .date {color: #69af22;}
  </style>  
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" body-color="#ffffff" data-background-image="../img/tud-title-bg-wide-2021.png" class="quarto-title-block center">
  <h1 class="title">x4-Pipelines in R</h1>
  <p class="subtitle">Angewandte Statistik – Ein Praxiskurs</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Thomas Petzoldt 
</div>
</div>
</div>

  <p class="date">2025-10-15</p>
</section>
<section id="prerequisites" class="slide level2">
<h2>Prerequisites</h2>
<p><br></p>
<p>The examples in slis slide require the following <strong>R</strong> packages: packages, that must be installed and loaded.</p>
<p><br></p>
<p><strong>Installation</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"dplyr"</span>, <span class="st">"tiryr"</span>, <span class="st">"lubridate"</span>, <span class="st">"readxl"</span>, <span class="st">"ggplot2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong>Loading</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb2-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb2-3"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb2-4"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readxl"</span>)</span>
<span id="cb2-5"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>The examples were tested with <strong>R</strong> 4.3.1 and <strong>RStudio</strong> 2023.06.1</p>
</section>
<section id="an-introductory-example" class="slide level2">
<h2>An introductory example</h2>
<ul>
<li><p>In a statistics course, two samples of Maple (<em>Acer platanoides</em>) leaves were collected by two groups of students:</p></li>
<li><p>group <strong>HSE</strong>: had the freedom to collect leaves individually from trees close to the institute</p></li>
<li><p>group <strong>HYB</strong>: got a random sample from the supervisor</p></li>
</ul>
<p><strong>Hypothesis:</strong> sampling bias may affect statistical parameters, especially mean and variance.</p>
<div class="column add-space" style="width:59%;">
<p>Download the file <a href="https://raw.githubusercontent.com/tpetzoldt/datasets/main/data/leaves.csv">leaves.csv</a>, save it to a working directory and then read it with <code>read.csv</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"leaves.csv"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Have a look at the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(leaves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group no length width stalk
1   HSE  1     83    87    74
2   HSE  2    130   153   105
3   HSE  3    140   148   135
4   HSE  4    102   110    94
5   HSE  5    190   151    89
6   HSE  6    225   139    91</code></pre>
</div>
</div>
</div><div class="column" style="width:34%;">
<p><img data-src="../img/leaves_measures.png"></p>
</div></section>
<section id="a-boxplot" class="slide level2">
<h2>A boxplot</h2>
<p><br></p>
<div class="bigfont">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(width <span class="sc">~</span> group, <span class="at">data=</span>leaves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="x4-pipes-intro_files/figure-revealjs/leaves-boxplot-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="summary-statistics" class="slide level2">
<h2>Summary statistics</h2>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(leaves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    group                 no             length           width      
 Length:126         Min.   :  1.00   Min.   : 37.00   Min.   : 44.0  
 Class :character   1st Qu.: 32.25   1st Qu.: 72.00   1st Qu.: 96.0  
 Mode  :character   Median : 63.50   Median : 90.00   Median :118.5  
                    Mean   : 63.50   Mean   : 95.83   Mean   :117.4  
                    3rd Qu.: 94.75   3rd Qu.:102.00   3rd Qu.:138.5  
                    Max.   :126.00   Max.   :250.00   Max.   :199.0  
     stalk       
 Min.   : 29.00  
 1st Qu.: 62.00  
 Median : 82.00  
 Mean   : 81.89  
 3rd Qu.:101.00  
 Max.   :175.00  </code></pre>
</div>
</div>
</section>
<section id="summary-statistics-per-group" class="slide level2">
<h2>Summary statistics per group</h2>
<p><br></p>
<ul>
<li>different ways to calculate summary statistics</li>
<li>classical method with <code>aggregate</code></li>
</ul>
<p><strong>A few examples</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(length, width, stalk) <span class="sc">~</span> group, mean, <span class="at">data=</span>leaves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group    length    width     stalk
1   HSE 137.82857 139.0286 102.02857
2   HYB  79.67033 109.1319  74.14286</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(length, width, stalk) <span class="sc">~</span> group, sd, <span class="at">data=</span>leaves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group   length    width    stalk
1   HSE 47.99356 26.07285 26.47917
2   HYB 19.93771 30.90423 25.24087</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(length, width, stalk) <span class="sc">~</span> group, min, <span class="at">data=</span>leaves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  group length width stalk
1   HSE     83    87    52
2   HYB     37    44    29</code></pre>
</div>
</div>
<p><br></p>
<p><code>aggregate</code> is very powerful, but the modern “tidyverse” approach is easier to understand. This is explained in the following.</p>
</section>
<section id="summary-statistics-with-the-dplyr-package" class="slide level2">
<h2>Summary statistics with the <code>dplyr</code>-package</h2>
<p>Package <strong>dplyr</strong> contains two handy functions:</p>
<ul>
<li><code>group_by</code></li>
<li><code>summarize</code></li>
</ul>
<p>The functions can be combined in different ways:</p>
<p><strong>A) Two separate code lines</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a aria-hidden="true" tabindex="-1"></a>leaves_grouped <span class="ot">&lt;-</span> <span class="fu">group_by</span>(leaves, group)</span>
<span id="cb15-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(leaves_grouped, <span class="at">mean =</span> <span class="fu">mean</span>(width), <span class="at">sd =</span> <span class="fu">sd</span>(width), <span class="at">min =</span> <span class="fu">min</span>(width), <span class="at">max =</span> <span class="fu">max</span>(width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="red"><span class="math inline">\(\ominus\)</span></span> needs a temporary variable: <code>leaves_grouped</code></p>
<p><br> <strong>B) One line, <code>group_by</code> enclosed in parentheses</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="fu">group_by</span>(leaves, group), <span class="at">mean=</span><span class="fu">mean</span>(width), <span class="at">sd=</span><span class="fu">sd</span>(width), <span class="at">min=</span><span class="fu">min</span>(width), <span class="at">max=</span><span class="fu">max</span>(width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="red"><span class="math inline">\(\oplus\)</span></span> no temporary variables necessary <br> <span class="red"><span class="math inline">\(\ominus\)</span></span> nested parentheses</p>
</section>
<section id="more-streamlined-pipelines" class="slide level2">
<h2>More streamlined: pipelines</h2>
<p><br></p>
<p>Aim to make code easier to understand:</p>
<ul>
<li>avoids nested parentheses</li>
<li>avoids temporary variables</li>
</ul>
<p>Recent versions of <strong>R</strong> (since 4.1) have built-in support for pipelines:</p>
<ul>
<li>Native pipeline operator <strong><span class="red">|&gt;</span></strong></li>
</ul>
<p>A predecessor was the so-called “magrittr” pipeline operator <strong><span class="blue">%&gt;%</span></strong></p>
<ul>
<li>Most examples from these slides will work with both pipeline operators.</li>
<li>There are a few differences regarding use of so-called placeholders.</li>
<li>I recommended to prefer native pipes <strong><span class="red">|&gt;</span></strong></li>
</ul>

<aside><div>
<p>The `%&gt;%-pipeline was introduced by the user-contributed <strong>magrittr</strong> package <span class="citation" data-cites="bache_magrittr_2022">(<a href="#/references" role="doc-biblioref" onclick="">Bache &amp; Wickham, 2022</a>)</span> and became very popular. It is automatically loaded by the <strong>dplyr</strong> package <span class="citation" data-cites="wickham_dplyr_2023">(<a href="#/references" role="doc-biblioref" onclick="">Wickham, François, et al., 2023</a>)</span>. In his new book, Hadley Wickham recommends native pipes <span class="citation" data-cites="wickham_r_2023">(<a href="#/references" role="doc-biblioref" onclick="">Wickham, Çetinkaya-Rundel, et al., 2023</a>)</span>.</p>
</div></aside></section>
<section id="application-of" class="slide level2">
<h2>Application of <strong><span class="red"><code>|&gt;</code></span></strong></h2>
<p><br></p>
<p><strong>The output from the first function is piped to the next</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(leaves, group) <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(width), <span class="at">sd =</span> <span class="fu">sd</span>(width), </span>
<span id="cb17-3"><a aria-hidden="true" tabindex="-1"></a>          <span class="at">min =</span> <span class="fu">min</span>(width), <span class="at">max =</span> <span class="fu">max</span>(width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong>Or, even more streamlined: start pipeline with the data frame</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(width), <span class="at">sd =</span> <span class="fu">sd</span>(width), </span>
<span id="cb18-4"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(width), <span class="at">max =</span> <span class="fu">max</span>(width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  group  mean    sd   min   max
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
1 HSE    139.  26.1    87   195
2 HYB    109.  30.9    44   199</code></pre>
</div>
</div>
</section>
<section id="how-it-works" class="slide level2">
<h2>How it works</h2>
<p>The pipe operator <span class="red">|&gt;</span> inserts the output from one function<br> into the first argument of the next function.</p>
<p><br></p>
<div class="column" style="width:49%;">
<p><strong>Classical functional style</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(leaves, group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-f956d88fc1567b277c37" style="width:432px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-f956d88fc1567b277c37">{"x":{"diagram":"digraph functional {\n         graph [rankdir = \"LR\", bgcolor=\"none\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             \"input\", \"output\"\n           node [shape = \"oval\"]\n             \"function(arg1, arg2, ...)\"\n           edge [penwidth=1.5]\n              output -> \"function(arg1, arg2, ...)\"[dir=back]\n           edge [penwidth=0.7, tailport = \"e\", headport = \"n\", constraint = false, color=\"tomato\"]\n              \"input\" -> \"function(arg1, arg2, ...)\"\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div><div class="column" style="width:49%;">
<p><strong>Pipeline style</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="sc">|&gt;</span> <span class="fu">group_by</span>(group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="grViz html-widget html-fill-item" id="htmlwidget-4787c920714dd9cbf557" style="width:432px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-4787c920714dd9cbf557">{"x":{"diagram":"digraph pipes {\n         graph [rankdir = \"LR\", bgcolor=\"none\"]\n           node [shape = box, penwidth=2, fontname = \"Helvetica\"]\n             \"input\", \"output\"\n           node [shape = \"oval\"]\n             \"function(arg2, ...)\"\n           node [shape=none]\n             \"|>\"\n           edge [penwidth=1.5]\n              input -> \"|>\" -> \"function(arg2, ...)\" -> output\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div></section>
<section id="summary-statistics-for-all-variables" class="slide level2">
<h2>Summary statistics for all variables</h2>
<ul>
<li>The <code>leaves</code> dataset contains different variables <code>length</code>, <code>width</code> and <code>stalk</code> length.</li>
<li>We can now, in principle, extend <code>summarize</code>:</li>
</ul>
<p><strong>Add more code rows</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_l=</span><span class="fu">mean</span>(width),  <span class="at">sd_l=</span><span class="fu">sd</span>(width),  <span class="at">min_l=</span><span class="fu">min</span>(width),  <span class="at">max_l=</span><span class="fu">max</span>(width),</span>
<span id="cb22-4"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_w=</span><span class="fu">mean</span>(length), <span class="at">sd_w=</span><span class="fu">sd</span>(length), <span class="at">min_w=</span><span class="fu">min</span>(length), <span class="at">max_w=</span><span class="fu">max</span>(length),</span>
<span id="cb22-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_s=</span><span class="fu">mean</span>(stalk),  <span class="at">sd_s=</span><span class="fu">sd</span>(stalk),  <span class="at">min_s=</span><span class="fu">min</span>(stalk),  <span class="at">max_s=</span><span class="fu">max</span>(stalk)</span>
<span id="cb22-6"><a aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong>Is copy and paste a good idea?</strong></p>
<p><strong>No</strong>, at least not in excess.</p>
<ul>
<li>Copy and paste can lead to errors.</li>
<li>… and there are more compact and elegant ways.</li>
</ul>
</section>
<section id="tidy-your-data-and-use-long-data-formats" class="slide level2">
<h2>Tidy your data and use “long” data formats!</h2>
<p><br></p>
<div class="bigfont">
<p><span class="red">Long data formats are more database like and more flexible.</span></p>
<p><br></p>
<p>If you are used to working with LibeOffiice or Excel, you will probably prefer “wide” tables that fit well on the computer screen. However, this is not such a good idea for data bases and scripted data science.</p>
<p>Modern data analysis packages like <strong>dplyr</strong> and <strong>ggplot2</strong> mandatorily require the long format.</p>
</div>
</section>
<section id="long-data-format-tidy-format" class="slide level2">
<h2>Long data format (= tidy format)</h2>
<ul>
<li>Put data from all 3 variables in one column: <code>length, width, stalk</code> <span class="math inline">\(\rightarrow\)</span> <code>value</code></li>
<li>Identifier column for the variables: <code>name</code></li>
</ul>
<div class="column" style="width:49%;">
<p><strong>Wide format</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: right;">no</th>
<th style="text-align: right;">length</th>
<th style="text-align: right;">width</th>
<th style="text-align: right;">stalk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">87</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">153</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">148</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">190</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">89</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">225</td>
<td style="text-align: right;">139</td>
<td style="text-align: right;">91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">165</td>
<td style="text-align: right;">76</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">216</td>
<td style="text-align: right;">135</td>
<td style="text-align: right;">113</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">250</td>
<td style="text-align: right;">195</td>
<td style="text-align: right;">119</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">152</td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">158</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:49%;">
<p><strong>Long format</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: right;">no</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">length</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">width</td>
<td style="text-align: right;">87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">stalk</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">length</td>
<td style="text-align: right;">130</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">width</td>
<td style="text-align: right;">153</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">stalk</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">length</td>
<td style="text-align: right;">140</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">width</td>
<td style="text-align: right;">148</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">stalk</td>
<td style="text-align: right;">135</td>
</tr>
<tr class="even">
<td style="text-align: left;">HSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">length</td>
<td style="text-align: right;">102</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>… … …</p>
</div></section>
<section id="long-data-format-with-pivot_longer" class="slide level2">
<h2>Long data format with <code>pivot_longer</code></h2>
<p><br></p>
<div class="bigfont">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"length"</span>, <span class="st">"width"</span>, <span class="st">"stalk"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 378 × 4
   group    no name   value
   &lt;chr&gt; &lt;int&gt; &lt;chr&gt;  &lt;int&gt;
 1 HSE       1 length    83
 2 HSE       1 width     87
 3 HSE       1 stalk     74
 4 HSE       2 length   130
 5 HSE       2 width    153
 6 HSE       2 stalk    105
 7 HSE       3 length   140
 8 HSE       3 width    148
 9 HSE       3 stalk    135
10 HSE       4 length   102
# ℹ 368 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="summary-statistics-for-all-variables-groupwise" class="slide level2">
<h2>Summary statistics for all variables groupwise</h2>
<p><br></p>
<div class="bigfont">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"length"</span>, <span class="st">"width"</span>, <span class="st">"stalk"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, name) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value), </span>
<span id="cb25-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value), </span>
<span id="cb25-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">min  =</span> <span class="fu">min</span>(value),</span>
<span id="cb25-7"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">max  =</span> <span class="fu">max</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
# Groups:   group [2]
  group name    mean    sd   min   max
  &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
1 HSE   length 138.   48.0    83   250
2 HSE   stalk  102.   26.5    52   175
3 HSE   width  139.   26.1    87   195
4 HYB   length  79.7  19.9    37   124
5 HYB   stalk   74.1  25.2    29   144
6 HYB   width  109.   30.9    44   199</code></pre>
</div>
</div>
</div>
</section>
<section id="pipes-and-the-assignment-operator--" class="slide level2">
<h2>Pipes and the assignment operator <code>&lt;-</code></h2>
<p><br></p>
<ul>
<li>In the examples before, the pipe-output was directly printed to the screen</li>
<li>If we need the result in a subsequent operation, we assign it to a variable as usual with <code>&lt;-</code></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> </span>
<span id="cb27-2"><a aria-hidden="true" tabindex="-1"></a>  leaves <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"length"</span>, <span class="st">"width"</span>, <span class="st">"stalk"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, name) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(value), <span class="at">sd=</span><span class="fu">sd</span>(value), <span class="at">min=</span><span class="fu">min</span>(value), <span class="at">max=</span><span class="fu">max</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Don’t get confused!</p>
<ul>
<li>the pipe starts with <code>leaves</code> in the second code line</li>
<li>the direction of the pipeline is from left <span class="math inline">\(\rightarrow\)</span> right</li>
<li>then the of the <strong>complete pipeline</strong> is assigned to <code>totals</code></li>
</ul>
<p>It follows the convention, that the result of an equation is assigned from right to the left.</p>
</section>
<section id="reverse-assignment" class="slide level2">
<h2>Reverse assignment?</h2>
<p><br></p>
<p>“More logical”, but less common would be a consequent left to the right notation with <code>-&gt;</code></p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a aria-hidden="true" tabindex="-1"></a>leaves <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"length"</span>, <span class="st">"width"</span>, <span class="st">"stalk"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, name) <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(value), <span class="at">sd=</span><span class="fu">sd</span>(value), <span class="at">min=</span><span class="fu">min</span>(value), <span class="at">max=</span><span class="fu">max</span>(value)) <span class="ot">-&gt;</span></span>
<span id="cb28-5"><a aria-hidden="true" tabindex="-1"></a>  totals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Amelia McNamara used this style in her keynote talk at the 2020 use!R conference about <a href="https://youtu.be/ckW9sSdIVAc">Speaking R</a> on youtube.</p>
<p>But, Headley Wickham discouraged this style, because the <code>-&gt;</code> breaks with mathematical convention and is difficult to spot in the code.</p>
</section>
<section id="indentation" class="slide level2">
<h2>Indentation</h2>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> </span>
<span id="cb29-2"><a aria-hidden="true" tabindex="-1"></a>  leaves <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"length"</span>, <span class="st">"width"</span>, <span class="st">"stalk"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group, name) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(value), <span class="at">sd=</span><span class="fu">sd</span>(value), <span class="at">min=</span><span class="fu">min</span>(value), <span class="at">max=</span><span class="fu">max</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>The pipeline above shows essentially <span class="blue">one single line of code</span>.</p>
<ul>
<li>To improve readability, code lines should not be longer than 80 characters.</li>
<li>Remember: Line breaks can be at any position, as long as a code line is not complete.</li>
<li>Common style: make a newline after <code>&lt;-</code> and <code>|&gt;</code> and use 2 characters for indentation.</li>
</ul>
</section>
<section>
<section id="pipelines-tidy-data-and-plotting" class="title-slide slide level1 center">
<h1>Pipelines, tidy data and plotting</h1>

</section>
<section id="the-clementine-orange-data-set" class="slide level2">
<h2>The Clementine orange data set</h2>

<img data-src="../img/caliper.jpg" style="width:50.0%" class="r-stretch"></section>
<section id="clementine-orange-data-set" class="slide level2">
<h2>Clementine orange data set</h2>
<p><br></p>
<ul>
<li>Samples of clementine oranges, measured, weighed and consumed in a statistic course.</li>
<li>Excel file with two tables:
<ul>
<li>long table with the <strong>fruits</strong></li>
<li>shorter table <strong>brands</strong> with meta data</li>
</ul></li>
<li>Data can be downloaded from <a href="https://github.com/tpetzoldt/tpetzoldt.github.io/raw/master/RToolbox/../data/clementines_2019.xlsx">here</a>.</li>
</ul>
<p><br></p>
<p><strong>Read data directly from Excel file</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a aria-hidden="true" tabindex="-1"></a>brands  <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"clementines_2019.xlsx"</span>, <span class="st">"Brands"</span>)</span>
<span id="cb30-2"><a aria-hidden="true" tabindex="-1"></a>fruits  <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"clementines_2019.xlsx"</span>, <span class="st">"Fruits"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clementine-orange-data-set-1" class="slide level2">
<h2>Clementine orange data set</h2>
<p><br></p>
<div class="column" style="width:49%;">
<p><strong>Table “fruits”</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">brand</th>
<th style="text-align: right;">weight</th>
<th style="text-align: right;">width</th>
<th style="text-align: right;">height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">61.0</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">65.0</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">58.0</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">62.0</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">64.0</td>
<td style="text-align: right;">58</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">63.0</td>
<td style="text-align: right;">59</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">54.0</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">58.5</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">66.0</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">43.0</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">48.0</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">43.0</td>
<td style="text-align: right;">32</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column" style="width:49%;">
<p><strong>Table “brands”</strong></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">brand</th>
<th style="text-align: left;">type</th>
<th style="text-align: right;">kilogram</th>
<th style="text-align: right;">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EP</td>
<td style="text-align: left;">Gold</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">1.49</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">LB</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.49</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">LO</td>
<td style="text-align: left;">Bio</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">1.49</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">NX</td>
<td style="text-align: left;">Box</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">NP</td>
<td style="text-align: left;">Premium</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.29</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">NB</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.49</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: left;">NC</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.49</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></section>
<section id="database-join" class="slide level2">
<h2>Database join</h2>
<ul>
<li><strong>join</strong> two tables to bring the information together</li>
<li>In case of <strong><code>left_join</code></strong>, the (larger) main table is at the left.</li>
<li>The tables have two <span class="blue">key fields</span> in common: <code>year</code> and <code>brand</code>.</li>
<li>The key fields can be automatically detected or explicitly specified or renamed<br> <span class="math inline">\(\rightarrow\)</span> help page of <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></li>
</ul>
<!-- chunk two times, bugfix to suppress joining output -->
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a aria-hidden="true" tabindex="-1"></a>fruits2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fruits, brands)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="smallfont">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top" style="width:100%;">
<colgroup>
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">no</th>
<th style="text-align: right;">year</th>
<th style="text-align: left;">brand</th>
<th style="text-align: right;">weight</th>
<th style="text-align: right;">width</th>
<th style="text-align: right;">height</th>
<th style="text-align: right;">taste</th>
<th style="text-align: left;">shop</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">quality</th>
<th style="text-align: right;">kilogram</th>
<th style="text-align: right;">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">89</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">2019</td>
<td style="text-align: left;">EB</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Edeka</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: left;">Basic</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">2.99</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section>
<section>
<section id="exercise" class="title-slide slide level1 center">
<h1>Exercise</h1>
<p><br></p>
<ul>
<li>calculate summary statistics for a single data column (e.g.&nbsp;<code>weight</code>)</li>
<li>re-organize the tables with <code>pivot_longer</code> so that all measurements are in one column</li>
<li>calculate summary statistics for all measurements</li>
</ul>
</section>
<section id="selection-of-columns-and-rows-select-and-filter" class="slide level2">
<h2>Selection of columns and rows: <code>select</code> and <code>filter</code></h2>
<p><br></p>
<ul>
<li><code>select</code>: select columns</li>
<li><code>filter</code>: filters rows</li>
</ul>
<p><br></p>
<div class="bigfont">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a aria-hidden="true" tabindex="-1"></a>fruits2 <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(brand, shop, type, weight, width) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(shop <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Edeka"</span>, <span class="st">"Lidl"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 44 × 5
   brand shop  type  weight width
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 EB    Edeka Basic    107  61  
 2 EB    Edeka Basic    100  65  
 3 EB    Edeka Basic     89  58  
 4 EB    Edeka Basic     99  62  
 5 EB    Edeka Basic     99  64  
 6 EB    Edeka Basic     96  63  
 7 EB    Edeka Basic    100  54  
 8 EB    Edeka Basic     89  58.5
 9 EB    Edeka Basic     86  66  
10 EB    Edeka Basic     92  43  
# ℹ 34 more rows</code></pre>
</div>
</div>
</div>
</section>
<section id="create-or-transform-columns-mutate" class="slide level2">
<h2>Create or transform columns: <code>mutate</code></h2>
<div class="column" style="width:49%;">
<p><strong>Example</strong></p>
<p>Transform a variable, e.g.&nbsp;weight by <span class="math inline">\(x^{1/3}\)</span> into a theoretical mean diameter</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a aria-hidden="true" tabindex="-1"></a>fruits2 <span class="ot">&lt;-</span> </span>
<span id="cb34-2"><a aria-hidden="true" tabindex="-1"></a>  fruits2 <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">L_mean =</span> weight<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:49%;">
<p><strong>Show results</strong></p>
<p>Classical <code>boxplot</code></p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(L_mean <span class="sc">~</span> brand, <span class="at">data=</span>fruits2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="x4-pipes-intro_files/figure-revealjs/mutate-boxplot-1.png" width="480"></p>
</figure>
</div>
</div>
</div>
</div></section>
<section id="plot-in-tidyverse-style-with-pipes-and-ggplot" class="slide level2">
<h2>Plot in “tidyverse”-style with pipes and <code>ggplot</code></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a aria-hidden="true" tabindex="-1"></a>fruits2 <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">L_mean =</span> weight<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(brand, L_mean)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="x4-pipes-intro_files/figure-revealjs/fruits-ggplot-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="another-mutate-example" class="slide level2">
<h2>Another <code>mutate</code> example</h2>
<p>Let’s compare the measured weight of our fruits with a “theoretical volume” calculated from length and height using the formula of an ellipsoid. This is of course an approximation:</p>
<p><span class="math display">\[
V = 4/3 \pi \cdot \rm (length/2)^2 \cdot height/2
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a aria-hidden="true" tabindex="-1"></a>fruits <span class="ot">&lt;-</span></span>
<span id="cb37-2"><a aria-hidden="true" tabindex="-1"></a>  fruits <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">V =</span> <span class="fl">0.001</span> <span class="sc">*</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">*</span> pi <span class="sc">*</span> (width<span class="sc">/</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> height<span class="sc">/</span><span class="dv">2</span>, <span class="at">index =</span> weight <span class="sc">/</span> V)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="column" style="width:49%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb38-2"><a aria-hidden="true" tabindex="-1"></a>fruits <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(weight, index)) <span class="sc">+</span> </span>
<span id="cb38-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The “+” operator in <code>ggplot</code> looks like a pipeline, but works differently.</p>
<p>It adds elements to a plot.</p>
</div><div class="column" style="width:49%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="x4-pipes-intro_files/figure-revealjs/fruits-volume-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div></section>
<section id="color-coded-points" class="slide level2">
<h2>Color coded points</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-2"><a aria-hidden="true" tabindex="-1"></a>fruits <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(weight, index, <span class="at">color=</span>brand)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="x4-pipes-intro_files/figure-revealjs/fruits-color-coded-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="categorial-split-faceting-and-regression-line" class="slide level2">
<h2>Categorial split (faceting) and regression line</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a aria-hidden="true" tabindex="-1"></a>fruits <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(weight, V)) <span class="sc">+</span> </span>
<span id="cb40-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb40-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb40-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> brand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="x4-pipes-intro_files/figure-revealjs/fruits-categorial-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="modify-font-size" class="slide level2">
<h2>Modify font size</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a aria-hidden="true" tabindex="-1"></a>fruits <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(weight, V)) <span class="sc">+</span> </span>
<span id="cb41-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb41-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm, <span class="at">se=</span><span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb41-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> brand) <span class="sc">+</span></span>
<span id="cb41-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="x4-pipes-intro_files/figure-revealjs/fruits-increased-font-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"><p><span class="math inline">\(\rightarrow\)</span> <strong>themes</strong> allow to configure “almost everything” …</p>
</section>
<section id="discharge-of-the-elbe-river" class="slide level2">
<h2>Discharge of the Elbe River</h2>
<p>Elbe River in Dresden 2006-04-01</p>

<img data-src="../img/elbe.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:40.0%"></section>
<section id="read-data-to-r" class="slide level2">
<h2>Read data to R</h2>
<p><br></p>
<p>The example file <a href="https://raw.githubusercontent.com/tpetzoldt/datasets/main/data/elbe.csv">elbe.csv</a> contains daily discharge of the Elbe River in <span class="math inline">\(\mathrm{m^3 s^{-1}}\)</span> from gauging station Dresden, river km 55.6. The data are from the Federal Waterways and Shipping Administration (WSV) and where provided by the Federal Institute for Hydrology (BfG).</p>
<p><br></p>
<p>We can skip downloading and read the file directly from its internet location:</p>
<!--- read data from local file to save compilation time --->
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a aria-hidden="true" tabindex="-1"></a>elbe <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/tpetzoldt/datasets/main/data/elbe.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>The third column “validated” indicate whether the values were finally approved by WSV and BfG. Data of the 19th century are particularly uncertain. Please consult the file <a href="https://raw.githubusercontent.com/tpetzoldt/datasets/main/data/elbe_info.txt">elbe_info.txt</a> for details.</p>
</section>
<section id="date-and-time-conversion" class="slide level2">
<h2>Date and time conversion</h2>
<p><br></p>
<p>Now, let’s extend the <strong>elbe</strong> data frame by adding information about the day, month, year and day of year. Here function <code>mutate</code> adds additional columns.</p>
<p>Note also that the day of year function in the date and time package <strong>lubridate</strong> is named <code>yday</code>.</p>
<p>Details about date and time conversion can be found in the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/lubridate.pdf">lubridate cheatsheet</a>.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># a tidyverse package for dates</span></span>
<span id="cb43-2"><a aria-hidden="true" tabindex="-1"></a>elbe <span class="ot">&lt;-</span> <span class="fu">mutate</span>(elbe,</span>
<span id="cb43-3"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">date  =</span> <span class="fu">as.POSIXct</span>(date),</span>
<span id="cb43-4"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">day   =</span> <span class="fu">day</span>(date), </span>
<span id="cb43-5"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">month =</span> <span class="fu">month</span>(date), </span>
<span id="cb43-6"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">year  =</span> <span class="fu">year</span>(date), </span>
<span id="cb43-7"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">doy   =</span> <span class="fu">yday</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-data-structure" class="slide level2">
<h2>Inspect data structure</h2>
<p>If we work with <strong>RStudio</strong>, may have a look at the “Global Environment” pane and inspect the data structure of the <code>elbe</code> data frame.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">discharge</th>
<th style="text-align: left;">validated</th>
<th style="text-align: right;">day</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">doy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1989-01-01</td>
<td style="text-align: right;">765</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989-01-02</td>
<td style="text-align: right;">713</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1989-01-03</td>
<td style="text-align: right;">684</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989-01-04</td>
<td style="text-align: right;">612</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1989-01-05</td>
<td style="text-align: right;">565</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989-01-06</td>
<td style="text-align: right;">519</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1989-01-07</td>
<td style="text-align: right;">522</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989-01-08</td>
<td style="text-align: right;">524</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1989-01-09</td>
<td style="text-align: right;">544</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989-01-10</td>
<td style="text-align: right;">539</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1989-01-11</td>
<td style="text-align: right;">606</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: left;">1989-01-12</td>
<td style="text-align: right;">606</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="annual-summary-statistics" class="slide level2">
<h2>Annual summary statistics</h2>
<p><br></p>
<p><strong>Summarize data</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a aria-hidden="true" tabindex="-1"></a><span class="do">## calculate annual mean, minimum, maximum</span></span>
<span id="cb44-2"><a aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span> elbe <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(discharge), </span>
<span id="cb44-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(discharge), </span>
<span id="cb44-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">max =</span> <span class="fu">max</span>(discharge))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong>Show table of summary statistics</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(totals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
   year  mean   min   max
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  1989  268.   122   765
2  1990  217.    89   885
3  1991  189.    97   634
4  1992  267.    89  1090
5  1993  256.    92  1610
6  1994  317.    92  1030</code></pre>
</div>
</div>
<p><br> <strong>Exercise:</strong> Compute monthly discharge mean values and monthly sums.</p>
</section>
<section id="more-about-pivot-tables" class="slide level2">
<h2>More about pivot tables</h2>
<p><br></p>
<ul>
<li><p>In a section before, we already used <code>pivot_longer</code> to reorganize data. Now we do the opposite and convert a data base table (long data format) into a cross-table (wide data format) and vice versa.</p></li>
<li><p>R provides several function pairs for this, so you may see functions like <code>melt</code> and <code>cast</code> or <code>gather</code> and <code>spread</code>.</p></li>
<li><p>Recently the two functions <code>pivot_wider</code> and <code>pivot_longer</code> were recommended for this purpose.</p>
<ul>
<li>The first argument is a data base table, the other arguments define the structure of the desired crosstable.</li>
<li><code>id_cols</code> is the name of a column in a long table that will become the rows</li>
<li><code>names_from</code> indicates where the names of the columns are taken from</li>
<li><code>values_from</code> is the column with the values for the cross table.</li>
</ul></li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> If more than one value exists for a row x column combination, an optional aggregation function <code>values_fn</code> can be given.</p>
</section>
<section id="crosstable-with-one-column-per-year" class="slide level2">
<h2>Crosstable with one column per year</h2>
<p><br></p>
<div class="cell" data-fig="false">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a aria-hidden="true" tabindex="-1"></a>elbe_wide <span class="ot">&lt;-</span>  elbe <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> doy, </span>
<span id="cb47-3"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> year, </span>
<span id="cb47-4"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> discharge, </span>
<span id="cb47-5"><a aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fn =</span> mean)</span>
<span id="cb47-6"><a aria-hidden="true" tabindex="-1"></a>elbe_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong>Exercise</strong></p>
<ul>
<li>Create a suitable crosstable <code>elbe_wide</code>.</li>
<li>Then create a crosstable for monthly maximum discharge over all years.</li>
</ul>
<!--
pivot_wider(elbe, 
            id_cols = month, 
            names_from = year, 
            values_from = discharge, 
            values_fn = max)

/ -->
</section>
<section id="back-conversion-of-a-crosstable-into-a-data-base-table" class="slide level2">
<h2>Back-conversion of a crosstable into a data base table</h2>
<p><br></p>
<p>The inverse case is also possible, e.g.&nbsp;the conversion of a cross table into a data base table. It can be done with the function <code>pivot_longer</code>. The column of the <code>id.vars</code> variable(s) will become identifier(s) downwards.</p>
<p><br></p>
<div class="cell" data-fig="false">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(elbe_wide, <span class="at">names_to=</span><span class="st">"year"</span>, <span class="at">cols=</span><span class="fu">as.character</span>(<span class="dv">1989</span><span class="sc">:</span><span class="dv">2019</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong>Exercise</strong></p>
<p>Try it yourself.</p>
</section>
<section id="minimum-maximum-plot-with-summarize-and-ggplot2" class="slide level2">
<h2>Minimum-Maximum plot with summarize and ggplot2</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a aria-hidden="true" tabindex="-1"></a>elbe <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doy =</span> <span class="fu">yday</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doy) <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">max =</span> <span class="fu">max</span>(discharge), </span>
<span id="cb49-5"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(discharge), </span>
<span id="cb49-6"><a aria-hidden="true" tabindex="-1"></a>            <span class="at">min =</span> <span class="fu">min</span>(discharge)) <span class="sc">|&gt;</span></span>
<span id="cb49-7"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"min"</span>, <span class="st">"mean"</span>, <span class="st">"max"</span>), </span>
<span id="cb49-8"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"statistic"</span>, </span>
<span id="cb49-9"><a aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"discharge"</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-10"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(doy, discharge, <span class="at">color =</span> statistic)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="x4-pipes-intro_files/figure-revealjs/elbe-minmax-1.png" class="quarto-figure quarto-figure-center r-stretch" width="576"><p><strong>Exercise</strong></p>
<ul>
<li>Read the code and try to understand it. Then add a dry and a wet year.</li>
</ul>
</section>
<section id="cumulative-sums" class="slide level2">
<h2>Cumulative sums</h2>
<p>Annual cumulative sum plots are a hydrological standard tool used by reservoir managers. We can use the <strong>R</strong> function <code>cumsum</code>, that by successive cumulation converts a sequence of:</p>
<p><span class="math inline">\(x_1, x_2, x_3, x_4, \dots\)</span></p>
<p>into</p>
<p><span class="math inline">\((x_1), (x_1+x_2), (x_1+x_2+x_3), (x_1+x_2+x_3+x_4), \dots\)</span></p>
<p><br></p>
<p><strong>Example</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb50-2"><a aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  4  6 12 16 18 21</code></pre>
</div>
</div>
</section>
<section id="cumulative-sums-of-the-elbe-river" class="slide level2">
<h2>Cumulative sums of the Elbe River</h2>
<p>Cummulative sums allow to detect dry and wet years, or periods within years.</p>
<p>If we just use <code>cumsum</code>, we get a cumulative sum for all years:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a aria-hidden="true" tabindex="-1"></a>elbe <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doy =</span> <span class="fu">yday</span>(date), <span class="at">year =</span> <span class="fu">year</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="dv">2000</span><span class="sc">:</span><span class="dv">2010</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cum_discharge =</span> <span class="fu">cumsum</span>(discharge) <span class="sc">*</span> <span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-6"><a aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(doy, cum_discharge, <span class="at">color =</span> year)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="x4-pipes-intro_files/figure-revealjs/elbe-cumsum-1.png" class="quarto-figure quarto-figure-center r-stretch" width="576"><p>The multiplication with <span class="math inline">\(60 \cdot 60 \cdot 24\)</span> converts <span class="math inline">\(\rm m^3 s^{-1}\)</span> in <span class="math inline">\(\rm m^3 d^{-1}\)</span>.</p>
</section>
<section id="exercises" class="slide level2">
<h2>Exercises</h2>
<p><br></p>
<ol type="1">
<li>Repeat the same for other time periods (years).</li>
<li>Which year was the wettest, which one the driest year in total? Find a year with dry spring and wet summer.</li>
<li>Identify some (e.g.&nbsp;3 or 5) large floods in the historical time series and plot it together.</li>
<li>Modify the commands so that the hydrological year is shown. Note that the German hydrological year goes from 1st November to 31st October of the following year. Other countries have different regulations.</li>
</ol>
</section>
<section id="further-reading" class="slide level2">
<h2>Further reading</h2>
<p><br></p>
<p><strong>Online material</strong></p>
<ul>
<li>“Welcome to tidyverse: <a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a>.</li>
<li>“ggplot Elegant Graphics for Data Analysis: <a href="https://ggplot2-book.org/" class="uri">https://ggplot2-book.org/</a></li>
<li>“R for Data Science”: <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a></li>
<li>Hadley Wickham’s homepage: <a href="https://hadley.nz/" class="uri">https://hadley.nz/</a></li>
</ul>
<p><br></p>
<p><strong>Printed books</strong></p>
<ul>
<li>“R for Data Science” <span class="citation" data-cites="wickham_r_2023">(<a href="#/references" role="doc-biblioref" onclick="">Wickham, Çetinkaya-Rundel, et al., 2023</a>)</span></li>
<li>“ggplot Elegant Graphics for Data Analysis” <span class="citation" data-cites="wickham_ggplot2_2016">(<a href="#/references" role="doc-biblioref" onclick="">Wickham, 2016</a>)</span></li>
</ul>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-bache_magrittr_2022" class="csl-entry" role="listitem">
Bache, S. M., &amp; Wickham, H. (2022). <em>Magrittr: A forward-pipe operator for r</em>. <a href="https://CRAN.R-project.org/package=magrittr">https://CRAN.R-project.org/package=magrittr</a>
</div>
<div id="ref-wickham_ggplot2_2016" class="csl-entry" role="listitem">
Wickham, H. (2016). <em>ggplot2: Elegant graphics for data analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>
</div>
<div id="ref-wickham_r_2023" class="csl-entry" role="listitem">
Wickham, H., Çetinkaya-Rundel, M., &amp; Grolemund, G. (2023). <em><span>R</span> for data science</em> (2nd ed.). O’Reiley. <a href="https://r4ds.hadley.nz/">https://r4ds.hadley.nz/</a>
</div>
<div id="ref-wickham_dplyr_2023" class="csl-entry" role="listitem">
Wickham, H., François, R., Henry, L., Müller, K., &amp; Vaughan, D. (2023). <em>Dplyr: A grammar of data manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p><span style="color: white; font-size: small; font-weight:400; float: right; margin-top: 40px; margin-right: 4%;"> <a href="../">🏠 Home</a> </span></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>